"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[803],{20803:(e,t,s)=>{s.d(t,{AuthModalProvider:()=>x,X:()=>m});var n=s(95155),r=s(12115),a=s(35695),l=s(40283);function o(e){let{length:t=6,onComplete:s,error:a,disabled:l=!1}=e,[o,i]=(0,r.useState)(Array(t).fill("")),c=(0,r.useRef)([]);(0,r.useEffect)(()=>{c.current[0]&&c.current[0].focus()},[]),(0,r.useEffect)(()=>{o.every(e=>""!==e)&&o.join("").length===t&&s(o.join(""))},[o,t,s]);let d=(e,s)=>{if(s&&!/^\d$/.test(s))return;let n=[...o];if(n[e]=s,i(n),s&&e<t-1){var r;null==(r=c.current[e+1])||r.focus()}},u=(e,s)=>{var n,r,a;if("Backspace"===s.key){!o[e]&&e>0&&(null==(n=c.current[e-1])||n.focus());let t=[...o];t[e]="",i(t)}"ArrowLeft"===s.key&&e>0&&(null==(r=c.current[e-1])||r.focus()),"ArrowRight"===s.key&&e<t-1&&(null==(a=c.current[e+1])||a.focus())},x=e=>{var s;e.preventDefault();let n=e.clipboardData.getData("text").replace(/\D/g,"").slice(0,t),r=[...o];for(let e=0;e<n.length;e++)r[e]=n[e];i(r);let a=r.findIndex(e=>""===e),l=-1===a?t-1:a;null==(s=c.current[l])||s.focus()};return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("div",{className:"flex justify-center gap-2",children:Array.from({length:t}).map((e,t)=>(0,n.jsx)("input",{ref:e=>{c.current[t]=e},type:"text",inputMode:"numeric",maxLength:1,value:o[t],onChange:e=>d(t,e.target.value),onKeyDown:e=>u(t,e),onPaste:x,disabled:l,className:"\n              w-12 h-14 text-center text-2xl font-bold\n              border-2 rounded-lg\n              focus:outline-none focus:ring-2 focus:border-transparent\n              transition-all duration-200\n              ".concat(a?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-pink-500","\n              ").concat(l?"bg-gray-100 cursor-not-allowed":"bg-white","\n              ").concat(o[t]?"border-pink-500":"","\n            "),style:o[t]?{"--tw-ring-color":"#FB356D"}:{}},t))}),a&&(0,n.jsx)("p",{className:"text-center text-sm text-red-600",children:a})]})}var i=s(66766),c=s(79323);function d(e){let{isOpen:t,onClose:s}=e,[d,u]=(0,r.useState)(""),[x,h]=(0,r.useState)(!1),[p,f]=(0,r.useState)(""),[g,v]=(0,r.useState)(!1),[b,j]=(0,r.useState)(""),[k,N]=(0,r.useState)([]),[w,y]=(0,r.useState)(""),[L,C]=(0,r.useState)(!1),[M,S]=(0,r.useState)(!1),[E,A]=(0,r.useState)(0),[B,D]=(0,r.useState)(!1),W=(0,a.useRouter)(),{requestMagicLink:_,verifyOTPCode:z,isAuthenticated:K,devLogin:P}=(0,l.A)(),{returnUrl:F}=m();(0,r.useEffect)(()=>{K&&t&&s()},[K,t,s]),(0,r.useEffect)(()=>{t||(u(""),v(!1),f(""),j(""),h(!1),S(!1),A(0),D(!1))},[t]),(0,r.useEffect)(()=>{if(E<=0)return;let e=setInterval(()=>{A(e=>e<=1?0:e-1)},1e3);return()=>clearInterval(e)},[E]),(0,r.useEffect)(()=>{},[!1,t]);let I=async e=>{if(e.preventDefault(),d){f(""),h(!0);try{await _({email:d,returnUrl:F||void 0}),v(!0)}catch(e){f(e instanceof Error?e.message:"Kh\xf4ng thể gửi email. Vui l\xf2ng thử lại.")}finally{h(!1)}}},H=async e=>{j(""),h(!0);try{if(await z({email:d,code:e}),s(),F)W.push(F);else{let e=c.u.getUser();(null==e?void 0:e.is_partner)&&(null==e?void 0:e.partner_status)==="active"&&W.push("/partner")}}catch(e){j(e instanceof Error?e.message:"M\xe3 kh\xf4ng hợp lệ."),h(!1)}},O=async()=>{if(!(E>0)&&!M){j(""),f(""),D(!1),S(!0);try{await _({email:d,returnUrl:F||void 0}),D(!0),A(60),setTimeout(()=>D(!1),3e3)}catch(e){j(e instanceof Error?e.message:"Kh\xf4ng thể gửi lại m\xe3.")}finally{S(!1)}}};return t?(0,n.jsxs)("div",{className:"modal ".concat(t?"modal-open":""),children:[(0,n.jsxs)("div",{className:"modal-box max-w-sm w-full p-0 rounded-3xl overflow-hidden bg-base-100",children:[B&&(0,n.jsx)("div",{className:"absolute top-2 left-1/2 -translate-x-1/2 z-20 animate-fadeIn",children:(0,n.jsxs)("div",{className:"bg-success/10 text-success text-xs font-medium px-3 py-1.5 rounded-full flex items-center gap-1.5",children:[(0,n.jsx)("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),"Đ\xe3 gửi m\xe3 mới!"]})}),(0,n.jsxs)("div",{className:"relative pt-8 pb-5 px-6 text-center",children:[(0,n.jsx)("button",{onClick:s,className:"absolute right-4 top-4 w-8 h-8 rounded-full bg-base-200/80 flex items-center justify-center hover:bg-base-300 transition-colors","aria-label":"Đ\xf3ng",children:(0,n.jsx)("svg",{className:"w-4 h-4 text-base-content/60",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2.5,children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),(0,n.jsx)("div",{className:"w-14 h-14 mx-auto bg-gradient-to-br from-pink-100 to-rose-100 rounded-2xl flex items-center justify-center mb-3 shadow-sm",children:g?(0,n.jsx)("svg",{className:"w-7 h-7 text-rose-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:1.5,children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75"})}):(0,n.jsx)(i.default,{src:"/icon.png",alt:"Chung Đ\xf4i",width:32,height:32,className:"object-contain"})}),(0,n.jsx)("h3",{className:"text-lg font-semibold text-base-content",children:g?"Kiểm tra email":"Ch\xe0o mừng bạn"}),(0,n.jsx)("p",{className:"text-sm text-base-content/60 mt-1",children:g?"Nhập m\xe3 6 số đ\xe3 gửi đến email của bạn":"Đăng nhập hoặc đăng k\xfd để tiếp tục"})]}),(0,n.jsx)("div",{className:"px-6 pb-6",children:g?(0,n.jsxs)("div",{className:"space-y-5",children:[(0,n.jsxs)("div",{className:"bg-base-200/50 px-4 py-3 rounded-xl text-center",children:[(0,n.jsx)("p",{className:"text-xs text-base-content/50 mb-0.5",children:"Đ\xe3 gửi đến"}),(0,n.jsx)("p",{className:"text-sm font-medium",children:d})]}),(0,n.jsxs)("div",{children:[b&&(0,n.jsxs)("div",{className:"bg-error/10 text-error text-sm px-4 py-2.5 rounded-xl flex items-center gap-2 mb-4",children:[(0,n.jsx)("svg",{className:"w-4 h-4 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"})}),b]}),(0,n.jsx)(o,{onComplete:H,error:b,disabled:x})]}),(0,n.jsxs)("div",{className:"space-y-2 pt-2",children:[(0,n.jsx)("button",{onClick:O,disabled:x||M||E>0,className:"w-full py-2.5 text-sm font-medium text-primary hover:text-primary/80 disabled:text-base-content/30 transition-colors",children:M?(0,n.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,n.jsx)("span",{className:"loading loading-spinner loading-xs"}),"Đang gửi..."]}):E>0?"Gửi lại m\xe3 (".concat(E,"s)"):"Gửi lại m\xe3"}),(0,n.jsx)("button",{onClick:()=>{v(!1),u(""),f(""),j(""),A(0),D(!1)},className:"w-full py-2.5 text-sm text-base-content/50 hover:text-base-content/70 transition-colors",children:"D\xf9ng email kh\xe1c"})]})]}):(0,n.jsxs)("form",{onSubmit:I,className:"space-y-4",children:[p&&(0,n.jsxs)("div",{className:"bg-error/10 text-error text-sm px-4 py-2.5 rounded-xl flex items-center gap-2",children:[(0,n.jsx)("svg",{className:"w-4 h-4 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"})}),p]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm font-medium text-base-content/70 mb-1.5 block",htmlFor:"email",children:"Email"}),(0,n.jsx)("input",{id:"email",type:"email",value:d,onChange:e=>u(e.target.value),required:!0,autoFocus:!0,placeholder:"you@example.com",className:"w-full h-12 px-4 bg-base-200/50 border-0 rounded-xl text-base placeholder:text-base-content/30 focus:outline-none focus:ring-2 focus:ring-primary/30 transition-all",disabled:x})]}),(0,n.jsx)("button",{type:"submit",disabled:x||!d,className:"w-full h-12 bg-primary text-primary-content font-medium rounded-xl hover:brightness-110 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:x?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"loading loading-spinner loading-sm"}),"Đang gửi..."]}):"Tiếp tục"}),!1,(0,n.jsxs)("div",{className:"pt-4 space-y-2",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 text-xs text-base-content/50",children:[(0,n.jsx)("svg",{className:"w-4 h-4 text-success",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),"Kh\xf4ng cần mật khẩu"]}),(0,n.jsxs)("div",{className:"flex items-center gap-2 text-xs text-base-content/50",children:[(0,n.jsx)("svg",{className:"w-4 h-4 text-success",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),"Đăng nhập an to\xe0n với m\xe3 OTP"]}),(0,n.jsxs)("div",{className:"flex items-center gap-2 text-xs text-base-content/50",children:[(0,n.jsx)("svg",{className:"w-4 h-4 text-success",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),"Ho\xe0n to\xe0n miễn ph\xed"]})]})]})})]}),(0,n.jsx)("div",{className:"modal-backdrop",onClick:s})]}):null}let u=(0,r.createContext)(void 0);function x(e){let{children:t}=e,[s,a]=(0,r.useState)(!1),[l,o]=(0,r.useState)(null),i=()=>{a(!1),o(null)};return(0,n.jsxs)(u.Provider,{value:{openAuthModal:()=>{o(window.location.pathname+window.location.search),a(!0)},closeAuthModal:i,isAuthModalOpen:s,returnUrl:l},children:[t,(0,n.jsx)(d,{isOpen:s,onClose:i})]})}function m(){let e=(0,r.useContext)(u);if(void 0===e)throw Error("useAuthModal must be used within an AuthModalProvider");return e}}}]);