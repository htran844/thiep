(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[646],{68452:(e,t,n)=>{"use strict";n.d(t,{default:()=>E});var i=n(95155),a=n(12115),r=n(6874),s=n.n(r),l=n(60800),o=n(14960),c=n(85395),d=n(25895),u=n(10507),m=n(25278),h=n(39625),g=n(60541),x=n(54032),p=n(75341),v=n(50707),f=n(20400),_=n(51300),y=n(49129),j=n(77935),b=n(80246),k=n(23490),N=n(31335),w=n(23843);let C="chungdoi_visitor_id";function T(){var e,t,n;let i=localStorage.getItem(C);return i||(i=function(e){if("undefined"==typeof document)return null;for(let t of document.cookie.split(";")){let[n,i]=t.trim().split("=");if(n===e)return decodeURIComponent(i)}return null}(C)),i||(i=crypto.randomUUID()),localStorage.setItem(C,i),e=C,t=i,n=31536e3,"undefined"!=typeof document&&(document.cookie="".concat(e,"=").concat(encodeURIComponent(t),"; max-age=").concat(31536e3,"; path=/; SameSite=Lax")),i}var I=n(10810);let L={songlong_red:l.v,songlong_green:o.r,songlong_blue:c.W,vuonxuan_green:d.o,vuonxuan_red:u.g,vuonxuan_blue:m.X,longphung_red:h.o,longphung_green:g.o,longphung_blue:x.V,longphung_black:p.Y,anhdao_pink:v.k,chibi_red:f.B,thanhdiep_green:_.z,classic:l.v,elegant:o.r,romantic:c.W,nature:d.o,redV1:h.o},S={classic:"songlong_red",elegant:"songlong_green",romantic:"songlong_blue",nature:"vuonxuan_green",redV1:"longphung_red"};function E(e){var t,n,r,o,c,d,u,m;let{slug:h,initialData:g,initialError:x,initialViewLimitExceeded:p,initialTrialExpired:v}=e,[f,_]=(0,a.useState)(g||null),[C,E]=(0,a.useState)(!g&&!x),[D,O]=(0,a.useState)(x||null),[B,U]=(0,a.useState)(!1),[F,M]=(0,a.useState)(p||!1),[R,V]=(0,a.useState)(v||!1),z=(0,a.useRef)(null),{envelopeOpened:P,handleEnvelopeOpen:W,handleInvitationClick:$}=(0,I.j)({enabled:!C&&!D&&!!f});(0,a.useEffect)(()=>{var e;let t=null==f||null==(e=f.data)?void 0:e.musicTrackId;if(!t||!z.current)return;let n=(0,k.OL)(t);if(!n)return;let i=z.current;i.src=n.url,i.volume=.5,i.loop=!0,i.preload="metadata"},[null==f||null==(t=f.data)?void 0:t.musicTrackId]),(0,a.useEffect)(()=>{if(P)return;let e=setTimeout(()=>{U(!0)},500);return()=>clearTimeout(e)},[P]),(0,a.useEffect)(()=>{if(g){var e;let t=T();fetch("".concat(w.$.apiUrl,"/api/invite/").concat(h,"/view"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitorId:t})}).catch(e=>console.log("Error tracking view:",e)),(0,N.f0)("invitation_viewed",{invitation_id:g.id,slug:h,referrer:"undefined"!=typeof document&&document.referrer||"direct",template_id:(null==(e=g.data)?void 0:e.templateId)||"unknown"});return}x||(async()=>{try{var e;let t=await fetch("".concat(w.$.apiUrl,"/api/invite/").concat(h));if(!t.ok){let e=await t.json().catch(()=>({})),n=e.error||"unknown";if(410===t.status&&"trial_expired"===n){O({type:"trial_expired",message:e.message||"Thiệp cưới đ\xe3 hết thời gian d\xf9ng thử"}),E(!1);return}if(404===t.status){O({type:n,message:e.message||"Kh\xf4ng t\xecm thấy thiệp cưới"}),E(!1);return}O({type:"unknown",message:"Kh\xf4ng thể tải thiệp cưới"}),E(!1);return}let n=await t.json();_(n.invitation),n.viewLimitExceeded&&M(!0),n.trialExpired&&V(!0);let i=T();fetch("".concat(w.$.apiUrl,"/api/invite/").concat(h,"/view"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitorId:i})}).catch(e=>console.log("Error tracking view:",e)),(0,N.f0)("invitation_viewed",{invitation_id:n.invitation.id,slug:h,referrer:"undefined"!=typeof document&&document.referrer||"direct",template_id:(null==(e=n.invitation.data)?void 0:e.templateId)||"unknown"})}catch(e){O({type:"unknown",message:e instanceof Error?e.message:"Loi khong xac dinh"})}finally{E(!1)}})()},[h,g,x]);let J=async e=>{if(f&&e)try{_(t=>t?{...t,data:e}:null),(await fetch("".concat(w.$.apiUrl,"/api/invite/").concat(h,"/comments"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({comments:e.comments||[]})})).ok?console.log("Comments saved successfully"):console.warn("Failed to save comments to backend, but local state updated")}catch(e){console.error("Error saving comments:",e)}};if(C)return(0,i.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,i.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading invitation..."})]})});if(D&&!f)return"trial_expired"===D.type?(0,i.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-rose-50 to-white flex items-center justify-center p-4",children:(0,i.jsxs)("div",{className:"text-center max-w-md",children:[(0,i.jsx)("div",{className:"mx-auto h-16 w-16 text-rose-300 mb-5",children:(0,i.jsx)("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})})}),(0,i.jsx)("h3",{className:"text-xl font-medium text-gray-800 mb-3",children:"Thiệp cưới hiện chưa sẵn s\xe0ng"}),(0,i.jsx)("p",{className:"text-gray-500 mb-6 leading-relaxed",children:"Thiệp cưới n\xe0y đang được cập nhật. Vui l\xf2ng li\xean hệ c\xf4 d\xe2u ch\xfa rể để biết th\xeam th\xf4ng tin."}),(0,i.jsx)("div",{className:"pt-2",children:(0,i.jsxs)("p",{className:"text-sm text-gray-400",children:["Bạn muốn tạo thiệp cưới?"," ",(0,i.jsx)(s(),{href:"/?utm_source=trial_expired&utm_medium=referral&utm_campaign=guest_conversion",className:"text-rose-400 hover:text-rose-500 hover:underline",children:"Bắt đầu ngay"})]})})]})}):"not_published"===D.type?(0,i.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,i.jsxs)("div",{className:"text-center max-w-md",children:[(0,i.jsx)("div",{className:"mx-auto h-20 w-20 text-gray-400 mb-6",children:(0,i.jsx)("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),(0,i.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-3",children:"Thiệp Cưới Chưa Được Xuất Bản"}),(0,i.jsx)("p",{className:"text-gray-600",children:"Thiệp cưới n\xe0y đang trong qu\xe1 tr\xecnh chỉnh sửa v\xe0 chưa sẵn s\xe0ng để chia sẻ."})]})}):(0,i.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,i.jsxs)("div",{className:"text-center max-w-md",children:[(0,i.jsx)("div",{className:"mx-auto h-20 w-20 text-gray-400 mb-6",children:(0,i.jsx)("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,i.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-3",children:"Kh\xf4ng T\xecm Thấy Thiệp Cưới"}),(0,i.jsx)("p",{className:"text-gray-600 mb-6",children:"Thiệp cưới n\xe0y c\xf3 thể kh\xf4ng tồn tại hoặc đường dẫn kh\xf4ng ch\xednh x\xe1c."}),(0,i.jsx)(s(),{href:"/",className:"inline-block px-6 py-3 bg-gray-800 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Về Trang Chủ"})]})});let K=(null==f||null==(n=f.data)?void 0:n.templateId)||"songlong_red",A=L[K]||l.v,X=S[K]||K,q=(null==f?void 0:f.is_paid)===!0,H={songlong_red:"#CD5C5C",songlong_green:"#a8741a",songlong_blue:"#d8a7a7",vuonxuan_green:"#5d6a57",vuonxuan_red:"#D25F65",vuonxuan_blue:"#486C7D",longphung_red:"#680e0e",longphung_green:"#162614",longphung_blue:"#0A202F",anhdao_pink:"#ba4a59",chibi_red:"#c44d4d",classic:"#CD5C5C",elegant:"#a8741a",romantic:"#d8a7a7",nature:"#5d6a57",redV1:"#680e0e"}[K]||"#CD5C5C",Y=e=>{if(!e)return"";let t=e.trim().split(/\s+/);return t[t.length-1]||e},G=Y(null==f||null==(r=f.data)?void 0:r.groomName)||"Ch\xfa Rể",Q=Y(null==f||null==(o=f.data)?void 0:o.brideName)||"C\xf4 D\xe2u",Z=function(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(j.A,{children:[(0,i.jsx)(A,{data:{...null==f?void 0:f.data,musicTrackId:void 0},isEditable:!1,themeId:X,onDataChange:J}),!t&&!q&&(0,i.jsx)("div",{className:"w-full text-center py-3 px-4 bg-gradient-to-t from-black/5 to-transparent",children:(0,i.jsx)("a",{href:"https://chungdoi.com?utm_source=trial_watermark&utm_medium=referral&utm_campaign=guest_conversion",target:"_blank",rel:"noopener noreferrer",className:"text-xs text-black/40 hover:text-black/60 transition-colors",children:"Tạo thiệp miễn ph\xed tại ChungDoi.com"})})]}),!t&&(null==f||null==(e=f.data)?void 0:e.musicTrackId)&&(0,i.jsx)(b.T,{trackId:f.data.musicTrackId,audioRef:z,autoPlay:!0,volume:.5,themeColor:H})]})};return P?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("audio",{ref:z,style:{display:"none"}}),(0,i.jsx)("div",{onClick:$,className:"cursor-pointer",children:Z()}),(F||R)&&(0,i.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,i.jsx)("div",{className:"absolute inset-0 backdrop-blur-md bg-white/30"}),(0,i.jsxs)("div",{className:"relative bg-white rounded-2xl shadow-xl p-8 max-w-sm mx-4 text-center",children:[(0,i.jsx)("div",{className:"text-4xl mb-4",children:"❤️"}),(0,i.jsxs)("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:["Thiệp cưới của ",(null==f||null==(u=f.data)?void 0:u.groomName)||"Ch\xfa rể"," & ",(null==f||null==(m=f.data)?void 0:m.brideName)||"C\xf4 d\xe2u"]}),(0,i.jsx)("p",{className:"text-gray-500 text-sm",children:"Thiệp cưới hiện chưa sẵn s\xe0ng. Li\xean hệ c\xf4 d\xe2u ch\xfa rể để biết th\xeam th\xf4ng tin."}),(0,i.jsx)("div",{className:"mt-6 pt-4 border-t border-gray-100",children:(0,i.jsxs)("p",{className:"text-sm text-gray-500",children:["Bạn muốn tạo thiệp cưới?"," ",(0,i.jsx)(s(),{href:"/?utm_source=view_limit&utm_medium=referral&utm_campaign=guest_conversion",className:"text-rose-400 hover:text-rose-500 hover:underline",children:"Bắt đầu ngay"})]})})]})]})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("audio",{ref:z,style:{display:"none"}}),B&&(0,i.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100%",visibility:"hidden",pointerEvents:"none"},"aria-hidden":"true",children:Z(!0)}),(0,i.jsx)(y.m,{groomName:G,brideName:Q,weddingDate:null==f||null==(c=f.data)?void 0:c.date,templateId:K,onOpen:()=>{W(),(0,N.f0)("envelope_opened",{slug:h,invitation_id:null==f?void 0:f.id,is_anonymous:!0})},audioRef:(null==f||null==(d=f.data)?void 0:d.musicTrackId)?z:void 0})]})}},74426:(e,t,n)=>{Promise.resolve().then(n.bind(n,68452))}},e=>{var t=t=>e(e.s=t);e.O(0,[8229,2498,6874,3063,8452,5382,6242,5519,1270,8441,1684,7358],()=>t(74426)),_N_E=e.O()}]);